<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=10">
    <title>控制策略</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="dist/css/ionicons.min.css">
    <link rel="stylesheet" href="dist/css/AdminLTE.css">
    <link rel="stylesheet" href="dist/css/skins/_all-skins.css">
    <link rel="stylesheet" href="vince/css/vince.css">
    <link rel="stylesheet" href="vince/biao/css/font-awesome.min.css">
    <!--[if lt IE 9]>
    <script src="dist/js/html5shiv.min.js"></script>
    <script src="dist/js/respond.min.js"></script>
    <![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">

<div class="fuceng" id="tanchuang">
    <div class="fuqu">
        <div class="fuquzone">
            <div class="fuqulogo">

            </div>
            <p class="fuqutitle">
                策略管理
                <span class="fuclose" id="close-btn">×</span>
            </p>
            <div class="fuqubiao">
                <p><span>策略名称</span><input type="text" id="control-strategy-name"></p>
                <p><span class="tiaoshijian">响应开始时间：</span>
                    <input type="text" class="shi" id="xuanshi1" readonly value="2020-03-29">
                    <i class="glyphicon glyphicon-calendar fa fa-calendar"></i></p>
                <p><span class="tiaoshijian">调节结束时间: </span>
                    <input type="text" class="shi" id="xuanshi2" readonly value="2020-03-30">
                    <i class="glyphicon glyphicon-calendar fa fa-calendar"></i></p>
                <p><span>目标负荷：</span><input type="text" id="target-load"></p>
                <p style="overflow:hidden"><span>是否可用：</span>
                    <span class="rad">
                  <label for="keyong">可用</label>
                  <input type="radio" name="kf" id="keyong" checked="checked" class="enable-select-radio" value="可用"/>
             </span> <span class="rad">
                  <label for="bukeyong">不可用</label>
                  <input type="radio" name="kf" id="bukeyong" class="enable-select-radio" value="不可用"/>
          </span>
                </p>
                <p style="height:80px;"><span>策略解析:</span><textarea name="" id="strategy-analyze" cols="10"
                                                                    rows="10"></textarea></p>
            </div>
            <div class="fucelue">
                <p class="fuceluetitle">控制策略列表</p>
                <div class="fuquqieneit">
                    <div class="fuquqiejut">
                        <p>已控制设备列表</p>
                        <div class="fuqutable">
                            <li><span>策略名称</span><span>最高负荷</span><span>控制方式</span><span>操作</span></li>
                            <li><span>策略1</span><span>1000KW</span><span>启停</span><span><img
                                    src="vince/images/icon_27.png" alt=""></span></li>
                            <li><span>策略2</span><span>1000KW</span><span>变频</span><span><img
                                    src="vince/images/icon_27.png" alt=""></span></li>
                        </div>
                    </div>
                    <div class="fuquqiejut">
                        <p>未控制设备列表</p>
                        <div class="fuqutable">
                            <li><span>策略名称</span><span>最高负荷</span><span>控制方式</span><span>操作</span></li>
                            <li><span>策略1</span><span>1000KW</span><span>启停</span><span><img
                                    src="vince/images/icon_27.png" alt=""></span></li>
                            <li><span>策略2</span><span>1000KW</span><span>变频</span><span><img
                                    src="vince/images/icon_27.png" alt=""></span></li>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
            <div class="fuqusave">
                <input type="button" value="保存" id="safe-btn">
            </div>
        </div>
    </div>
</div>


<div class="wrapper">
    <header class="main-header">
        <a href="#" class="logo">
      <span class="logo-mini">
	  <img src="vince/images/v01.png">
	  </span>
            <span class="logo-lg"><img src="vince/images/v01.png">项目</span>
        </a>
        <nav class="navbar navbar-static-top">
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button"></a>
            <span class="all_title">华北理工大学能源优化调配及集群负荷控制系统</span>
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                    <li class="dropdown user user-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <img src="dist/img/user2-160x160.jpg" class="user-image" alt="User Image">
                            <span class="hidden-xs" id="right-admin-name">管理员</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="user-header">
                                <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                <p id="right-second-admin">
                                    姓名：管理员
                                    <!--<small>部门：信息部</small>-->
                                </p>
                            </li>
                            <li class="user-footer">
                                <div class="pull-right">
                                    <a href="login.html" class="btn btn-default btn-flat" id="logoutBtn">退出系统</a>
                                </div>
                            </li>
                        </ul>
                    </li>

                </ul>
            </div>
        </nav>
    </header>
    <aside class="main-sidebar">
        <section class="sidebar">
            <div class="user-panel">
                <div class="pull-left image">
                    <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                </div>
                <div class="pull-left info">
                    <p id="adminTxt">当前用户：管理员</p>
                    <p class="menu_time">
                        时间：<span id="nowTime">2016-9-13 16:12:14</span></p>
                </div>
            </div>

            <ul class="sidebar-menu">
                <li class="header">菜单 MENU</li>
                <li>
                    <a href="index.html">
                        <i class="fa fa-home" style="font-size: 22px"></i> <span>首页</span>
                    </a>
                </li>
                <li>
                    <a href="ssjc.html">
                        <i class="fa fa-eye"></i> <span>实时监测</span>
                    </a>
                </li>
                <li>
                    <a href="yxjc.html">
                        <i class="fa fa-print"></i> <span>运行监测</span>
                    </a>
                </li>
                <li class="treeview">
                    <a href="#">
                        <i class="fa fa-sliders"></i>
                        <span>负荷响应</span>
                        <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
                    </a>
                    <ul class="treeview-menu">
                        <li><a href="xyxgpj.html"><i class="fa fa-bookmark"></i> 响应效果评价</a></li>
                        <li><a href="fhxyfx.html"><i class="fa fa-bookmark"></i> 负荷响应分析</a></li>

                        <li><a href="xyfagl.html"><i class="fa fa-bookmark"></i> 响应方案管理</a></li>
                    </ul>
                </li>

                <li>
                    <a href="yjgl.html">
                        <i class="fa fa-bell"></i> <span>预警管理</span>
                    </a>
                </li>
                <li class="treeview">
                    <a href="#">
                        <i class="fa fa-gears"></i>
                        <span>设备管理</span>
                        <span class="pull-right-container">
              <i class="fa fa-angle-left pull-right"></i>
            </span>
                    </a>
                    <ul class="treeview-menu">
                        <li><a href="sbrk.html"><i class="fa fa-bookmark"></i> 设备入库</a></li>
                        <li><a href="sbaz.html"><i class="fa fa-bookmark"></i> 设备安装</a></li>
                        <li><a href="sbjx.html"><i class="fa fa-bookmark"></i> 设备检修</a></li>
                        <li><a href="sbbf.html"><i class="fa fa-bookmark"></i> 设备报废</a></li>
                        <li><a href="sbcx.html"><i class="fa fa-bookmark"></i> 设备查询</a></li>
                    </ul>
                </li>
                <li class="active">
                    <a href="kzcl.html">
                        <i class="fa fa-magnet"></i> <span>控制策略</span>
                    </a>
                </li>
                <li>
                    <a href="xtjc.html">
                        <i class="fa fa-map"></i> <span>系统集成</span>
                    </a>
                </li>
            </ul>
        </section>
    </aside>
    <div class="content-wrapper">
        <section class="content-header">
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> 首页</a></li>
                <li class="active">控制策略</li>
            </ol>
        </section>
        <div class="content qqq">
            <div class="yjgl">
                <div class="ssjc_right_up">
                    <div class="nei">
                        <div class="ssjc_ru_title">
                  <span class="left_ten">
                    查询条件
                  </span>
                            <div class="clear"></div>
                        </div>
                        <div class="sbaz_table">
                            <p><span class="float_left"><span>策略名称：</span><input type="text" id="query-name"></span>
                                <span class="float_right">
                    <input type="submit" value="查询" class="in_sub" id="query-select-btn">
                                    <input type="submit" value="添加策略"
                                           class="anniu lindianjia in_sub">
                 
                 </span>
                            <div class="clear"></div>

                            </p>
                        </div>
                    </div>
                    <div class="ssjc_right_bottom">
                        <div class="nei">
                            <p>数据列表</p>
                            <div class="ssjc_rub_table">
                                <table class="tj_table" border="0">
                                    <thead>
                                    <tr>
                                        <td>序号</td>
                                        <td>策略名称</td>
                                        <td>目标负荷</td>
                                        <td>策略解析</td>
                                        <td>是否可用</td>
                                        <td>响应开始时间</td>
                                        <td>调节结束时间</td>
                                        <td>操作</td>
                                    </tr>
                                    </thead>
                                    <tbody id="control-strategy-container">

                                    </tbody>
                                </table>
                                <div class="t_fanye">
                                    <span class="upten" id="start_page_btn"></span>
                                    <span class="up" id="prev_btn"></span>
                                    <span class="split"></span>
                                    <span class="page_info_one" id="current_page">第 1 / 1 页</span>
                                    <span class="split"></span>
                                    <span class="dowm" id="next_btn"></span>
                                    <span class="downten" id="last_page_btn"></span>
                                    <span class="page_info_two" id="total_page">共 1 页</span>
                                    <span class="page_info_three" id="single_page_count">共 0 条记录</span>
                                    <div class="clear"></div>
                                </div>
                            </div>
                            <div class="cheng_ershi"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b></b>
        </div>
        <strong>Copyright &copy; 2014-2016</strong>
    </footer>
    <div class="control-sidebar-bg"></div>
</div>
<script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
<script src="bootstrap/js/bootstrap.min.js"></script>
<script src="dist/js/app.min.js"></script>
<script src="dist/js/demo.js"></script>
<script src="vince/js/nicescroll.js"></script>
<script src="vince/js/demo.js"></script>

<script src="vince/datapick/js/moment.js"></script>
<script src="vince/datapick/js/daterangepicker.js"></script>
<script src="vince/js/echarts.min.js"></script>
<script type="text/javascript" src="vince/js/globalInfo.js"></script>
<script type="text/javascript" src="plugins/layer-v3.1.1/layer/layer.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#xuanshi1').daterangepicker({singleDatePicker: true}, function (start, end, label) {
            console.log(start.toISOString(), end.toISOString(), label);
        });
        $('#xuanshi2').daterangepicker({singleDatePicker: true}, function (start, end, label) {
            console.log(start.toISOString(), end.toISOString(), label);
        });
    });
</script>
<div id="sss" style="display:none;height:200px;width:200px;"></div>
<script src="vince/js/echarts.min.js"></script>
<script type="text/javascript">
    // var myChart1 = echarts.init(document.getElementById('sss'));
    // option1 = {
    // series: [{data: [247, 179]}]};
    // myChart1.setOption(option1);

    var control_strategy_container = $('#control-strategy-container');
    var start_page_btn = $('#start_page_btn');
    var prev_btn = $('#prev_btn');
    var next_btn = $('#next_btn');
    var last_page_btn = $('#last_page_btn');

    var currPage = 1;
    var lastPage = 1;

    var control_strategy_name = $('#control-strategy-name');
    var start_time = $('#xuanshi1');
    var end_time = $('#xuanshi2');
    var target_load = $('#target-load');
    var strategy_analyze = $('#strategy-analyze');
    var is_enable = $('.enable-select-radio');

    var safe_btn = $('#safe-btn');
    var query_select_btn = $('#query-select-btn');

    $(function () {
        showControlStrategyList();

        next_btn.click(function () {
            currPage = currPage + 1;
            if (currPage > lastPage)
                currPage = lastPage;

            showControlStrategyList();
        });

        prev_btn.click(function () {
            currPage = currPage - 1;
            if (currPage < 1)
                currPage = 1;
            showControlStrategyList();
        });

        last_page_btn.click(function () {
            currPage = lastPage;
            showControlStrategyList();
        });

        start_page_btn.click(function () {
            currPage = 1;
            showControlStrategyList();
        });


        safe_btn.click(function () {
            addControlStrategy();
        });

        query_select_btn.click(function () {
            showControlStrategyList();
        });

        $('#close-btn').click(function () {
            control_strategy_name.val('');
            target_load.val('');
            strategy_analyze.val('');
        })
    });

    //获取控制策略列表
    function showControlStrategyList() {
        control_strategy_container.empty();
        var strategy_name = $('#query-name').val();
        $.getJSON(
            'ajax_control_strategy_list',
            {
                strategy_name: strategy_name,
                current_page: currPage
            },
            function (data) {
                if (data.code == 11) {
                    $.each(data.control_strategy_list, function (i, v) {
                        $('#current_page').text('第 ' + data.page.current_page + '/' + data.page.page_count + ' 页');
                        $('#total_page').text('共 ' + data.page.page_count + ' 页');
                        $('#single_page_count').text('共 ' + data.page.record_count + ' 条记录');
                        lastPage = data.page.page_count;

                        var tr = $('<tr></tr>');
                        var td1 = $('<td></td>').text(v.csid);
                        var td2 = $('<td></td>').text(v.strategy_name);
                        var td3 = $('<td></td>').text(v.target_load + 'W');
                        var td4 = $('<td></td>').text(v.strategy_analyze);
                        var td5 = $('<td></td>').text(v.is_enable);
                        var td6 = $('<td></td>').text(v.start_time);
                        var td7 = $('<td></td>').text(v.end_time);
                        var td8 = $('<td></td>');

                        var handle = $('<a style="cursor: pointer" onclick="modifyControlStrategy(' + v.csid + ')">修改</a><span> | </span><a style="cursor: pointer" onclick="deleteStrategyItem(' + v.csid + ')"> 删除</a>');

                        td8.append(handle);
                        tr.append(td1).append(td2).append(td3).append(td4).append(td5).append(td6).append(td7).append(td8);
                        control_strategy_container.append(tr);
                    })
                } else {
                    layer.msg(data.msg, {icon: 5, time: 1000});
                }
            }
        )
    }

    //更新对应条目信息
    function modifyControlStrategy(csid) {
        $('#tanchuang').show();
        control_strategy_name.val('');
        target_load.val('');
        strategy_analyze.val('');
        safe_btn.click(function () {
            $.getJSON(
                'ajax_update_strategy_info',
                {
                    strategy_name: control_strategy_name.val(),
                    target_load: target_load.val(),
                    strategy_analyze: strategy_analyze.val(),
                    start_time: start_time.val(),
                    end_time: end_time.val(),
                    is_enable: is_enable.val(),
                    csid: csid
                },
                function (data) {
                    if (data.code == 31) {
                        layer.msg(data.msg, {icon: 1, time: 1000}, function () {
                            showControlStrategyList();
                            safe_btn.unbind('click');
                            $('#tanchuang').hide();
                        })
                    } else {
                        layer.msg(data.msg, {icon: 5, time: 1000});
                    }
                }
            )
        });

    }

    //删除对应条目信息
    function deleteStrategyItem(csid) {
        $.getJSON(
            'ajax_delete_strategy_item',
            {
                csid: csid
            },
            function (data) {
                if (data.code == 21) {
                    layer.msg(data.msg, {icon: 1, time: 1000}, function () {
                        showControlStrategyList();
                    })
                } else {
                    layer.msg(data.msg, {icon: 5, time: 1000});
                }
            }
        )
    }

    //添加控制策略
    function addControlStrategy() {
        if (checkDate(start_time.val(), end_time.val())) {
            $.getJSON(
                'ajax_add_control_strategy',
                {
                    strategy_name: control_strategy_name.val(),
                    target_load: target_load.val(),
                    strategy_analyze: strategy_analyze.val(),
                    start_time: start_time.val(),
                    end_time: end_time.val(),
                    is_enable: is_enable.val()
                },
                function (data) {
                    if (data.code == 1) {
                        layer.msg(data.msg, {icon: 1, time: 1000}, function () {
                            $('#tanchuang').hide();
                            safe_btn.unbind('click');
                            showControlStrategyList();
                        })
                    } else {
                        layer.msg(data.msg, {icon: 5, time: 1000});
                    }
                }
            )
        } else {
            layer.msg('调节结束日期不能早于响应开始日期', {icon: 5, time: 1000});
        }

    }

    //选择日期结束时间不能早于开始时间
    function checkDate(date1, date2) {
        var y1 = date1.split('-')[0];
        var m1 = date1.split('-')[1];
        var d1 = date1.split('-')[2];

        var y2 = date2.split('-')[0];
        var m2 = date2.split('-')[1];
        var d2 = date2.split('-')[2];

        if (y1 <= y2) {
            if (y1 == y2) {
                if (m1 <= m2) {
                    if (m1 == m2) {
                        if (d1 < d2) {
                            return true
                        } else {
                            return false
                        }
                    }
                    return true
                } else {
                    return false
                }
            }
            return true
        } else {
            return false
        }
    }
</script>
</body>
</html>

